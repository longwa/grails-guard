<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Grails Guard Plugin : Provides a way to execute Grails integration tests automatically when tests or artifacts change. This is very similar to the Rails plugin of the same name and a distant cousin of Spork." />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Grails Guard Plugin</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/longwa/grails-guard">View on GitHub</a>

          <h1 id="project_title">Grails Guard Plugin</h1>
          <h2 id="project_tagline">Provides a way to execute Grails integration tests automatically when tests or artifacts change. This is very similar to the Rails plugin of the same name and a distant cousin of Spork.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/longwa/grails-guard/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/longwa/grails-guard/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="grails-guard" class="anchor" href="#grails-guard"><span class="octicon octicon-link"></span></a>Grails Guard</h1>

<p>Guard provides a convenient way to run integration tests without having to suffer repetitive startup costs. Each time an
integration test suite runs, the grails environment must be compiled and bootstrapped. For a large application, especially one with many domain objects, this
can take over a minute just to run a single testcase. Over the course of several months this can lead to days of lost productivity just waiting
for tests to run. </p>

<p>This plugin borrows from the similarly named Rails plugin (although it is more targeted at just running tests in this incarnation).</p>

<p>The plugin essentially runs the tests in a loop, detecting changes to both the application code and the test code. If a change is detected, 
the selected test(s) are re-run. </p>

<h2>
<a name="versions" class="anchor" href="#versions"><span class="octicon octicon-link"></span></a>Versions</h2>

<p>Due to major changes in the test framework introduced in Grails 2.3, Guard now comes in two different versions:</p>

<ul>
<li>Version 1 - Compatible with Grails 2.0, 2.1, or 2.2</li>
<li>Version 2 - Compatible with Grails 2.3 or later.</li>
</ul><h2>
<a name="usage-version-2-" class="anchor" href="#usage-version-2-"><span class="octicon octicon-link"></span></a>Usage (Version 2) </h2>

<p>Starting with version 2, Guard is no longer implemented as a test phase. Guard is now enabled via the command line flag "-guard". </p>

<p>There are a few advantages to this approach. From an implementation standpoint, this allows Guard to fit more seamlessly into the new 2.3 test
framework. It will also (eventually) allow Guard to support functional tests in addition to integration tests.</p>

<p>To run your tests in guard mode, you need to do a few things:</p>

<ol>
<li>Enable the spring reloading agent by adding the "-reloading" flag to the command line</li>
<li>Disable forked mode execution for 'test' in BuildConfig.groovy </li>
<li>Enable guard by adding the "-guard" flag to the command line when running integration test(s)</li>
</ol><p>For example:</p>

<pre><code>grails -reloading -guard test-app integration: &lt;testpatterns...&gt;
grails -reloading -guard test-app integration: MyService
</code></pre>

<p>If you want to see the console output, use:</p>

<pre><code>grails -reloading -echoOut -guard test-app integration: &lt;testpatterns...&gt;
</code></pre>

<p>Finally, to make life easier, just create an alias in your .bashrc:</p>

<pre><code>alias guard='grails -reloading -echoOut -guard test-app integration:'
</code></pre>

<p>Then run:</p>

<pre><code>guard my.package.*
guard MyService
guard MyService MyOtherService
</code></pre>

<p>This will run the tests once as it normally would. Regardless of the success or failure of the tests, it will then enter 
a mode where it detects changes to application code and test code.  When a change is detected, it will indicate which file was changed
and then run the same test pattern again with the updates.</p>

<h2>
<a name="usage-version-1" class="anchor" href="#usage-version-1"><span class="octicon octicon-link"></span></a>Usage (Version 1)</h2>

<p>For version 1, Guard is still implemented as a test phase replacement for "integration:".</p>

<p>To run your tests in guard mode, you need to do a few things:</p>

<ol>
<li>Enable the spring reloading agent by adding the "-reloading" flag to the command line</li>
<li>Enable guard by specifying the "guard:" test phase after 'test-app'</li>
</ol><p>For example:</p>

<pre><code>grails -reloading test-app guard: &lt;testpatterns...&gt;
grails -reloading test-app guard: MyService
</code></pre>

<p>Finally, to make life easier, just create an alias in your .bashrc:</p>

<pre><code>alias guard='grails -reloading -echoOut test-app guard:'
</code></pre>

<p>Then run:</p>

<pre><code>guard my.package.*
guard MyService
guard MyService MyOtherService
</code></pre>

<h2>
<a name="ide-support" class="anchor" href="#ide-support"><span class="octicon octicon-link"></span></a>IDE Support</h2>

<p>IntelliJ (and possibly Eclipse though I haven't tried it) can also be used to run guard mode.</p>

<p>In IntelliJ, run an integration test once normally. This will give you a "configuration" for the test case which can be edited.
Click to edit the profile and add the -guard flag. You may also need to add the "-reloading" flag to the end of the command line.</p>

<p>When you run that configuration, IntelliJ will process the tests normally and then "spin" as if it's waiting for more tests. As you modify files,
you will see the same tests run again. Since guard never notifies the listeners that the test run is complete, IntelliJ will continue waiting for
tests until you stop it manually.</p>

<h2>
<a name="known-issues" class="anchor" href="#known-issues"><span class="octicon octicon-link"></span></a>Known Issues</h2>

<ul>
<li>Since the environment is not reloaded, tests must be careful to cleanup after themselves, even if running against the in-memory database since the create-drop
only happens when the environment is bootstrapped.</li>
<li>Depending on the classes being changed, you may encounter PermGem issues if Guard loops for an extending number of iterations.</li>
<li>If you have a large domain model, it can be very beneficial to disable Hibernate sessionFactory reloading by setting the hibernate.reload = false flag in DataSource.groovy</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Grails Guard Plugin maintained by <a href="https://github.com/longwa">longwa</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
